/************************************************
*                   File.cpp                    *
*************************************************
*          This file is a part of:              *
*               COLUMBUS ENGINE                 *
*************************************************
*                Nika(Columbus) Red             *
*                   05.11.2017                  *
*************************************************/

#include <System/File.h>

namespace Columbus
{

	bool FileReadBytes(void* aData, size_t aSize, FILE* aFile)
	{
		if (fread(aData, aSize, 1, aFile) != 1) return false;
		else return true;
	}
	//////////////////////////////////////////////////////////////////////////////
	bool FileReadUint8(uint8_t* aData, FILE* aFile)
	{
		return FileReadBytes(aData, sizeof(uint8_t), aFile);
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	struct File::FileData
	{
		FILE* file = nullptr;
		std::string name;
	};
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	File::File() :
		mData(new FileData())
	{}
	//////////////////////////////////////////////////////////////////////////////
	File::File(File& aOther) :
		mData(new FileData())
	{
		mData->file = aOther.mData->file;
		mData->name = aOther.mData->name;
		aOther.mData->file = nullptr;
		aOther.mData->name = "";
	}
	//////////////////////////////////////////////////////////////////////////////
	File::File(std::string aFile, std::string aModes) :
		mData(new FileData())
	{
		open(aFile, aModes);
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	File& File::operator=(File& aOther)
	{
		if (this == &aOther) return *this;
		FileData* d = mData;
		mData = aOther.mData;
		aOther.mData = d;
		return *this;
	}
	//////////////////////////////////////////////////////////////////////////////
	File& File::operator<<(const char aChar)
	{
		write(&aChar, sizeof(char), 1);
		return *this;
	}
	//////////////////////////////////////////////////////////////////////////////
	File& File::operator<<(const std::string aString)
	{
		write(aString.c_str(), aString.size() * sizeof(char), 1);
		return *this;
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	bool File::open(std::string aFile, std::string aModes)
	{
		mData->file = fopen(aFile.c_str(), aModes.c_str());
		if (mData->file != nullptr)
		{
			mData->name = aFile;
			return true;
		}
		return false;
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::close()
	{
		bool ret = false;

		if (mData->file != nullptr)
		{
			ret = fclose(mData->file) == 0;
			mData->file = nullptr;
		}
		
		mData->name.clear();
		return ret;
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	std::string File::getName() const
	{
		return mData->name;
	}
	//////////////////////////////////////////////////////////////////////////////
	size_t File::getSize() const
	{
		if (!mData->file) return 0;

		size_t offset = ftell(mData->file);
		fseek(mData->file, 0, SEEK_END);
		size_t size = ftell(mData->file);
		fseek(mData->file, offset, SEEK_SET);

		return size;
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	bool File::eof() const
	{
		return (feof(mData->file) == 0);
	}
	//////////////////////////////////////////////////////////////////////////////
	int File::getc() const
	{
		return (fgetc(mData->file) == 0);
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::seekSet(long int aOffset) const
	{
		return (fseek(mData->file, aOffset, SEEK_SET) == 0);
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::seekEnd(long int aOffset) const
	{
		return (fseek(mData->file, aOffset, SEEK_END) == 0);
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::seekCur(long int aOffset) const
	{
		return (fseek(mData->file, aOffset, SEEK_CUR) == 0);
	}
	//////////////////////////////////////////////////////////////////////////////
	int File::tell() const
	{
		if (!isOpened()) return 0;
		return ftell(mData->file);
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::flush() const
	{
		if (!isOpened()) return false;
		return (fflush(mData->file) == 0);
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	bool File::isOpened() const
	{
		return (mData->file != nullptr);
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	size_t File::read(void* aData, size_t aSize, size_t aPacks) const
	{
		if (!isOpened()) return 0;
		return fread(aData, aSize, aPacks, mData->file);
	}
	//////////////////////////////////////////////////////////////////////////////
	size_t File::write(const void* aData, size_t aSize, size_t aPacks) const
	{
		if (!isOpened()) return 0;
		return fwrite(aData, aSize, aPacks, mData->file);
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	bool File::readBytes(void* aData, size_t aSize)
	{
		if (!aData) return false;
		if (!isOpened()) return false;
		if (fread(aData, aSize, 1, mData->file) != 1) return false;
		else return true;
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::readUint8(uint8_t* aData)
	{
		return readBytes(aData, sizeof(uint8_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::readInt8(int8_t* aData)
	{
		return readBytes(aData, sizeof(int8_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::readUint16(uint16_t* aData)
	{
		return readBytes(aData, sizeof(uint16_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::readInt16(int16_t* aData)
	{
		return readBytes(aData, sizeof(int16_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::readUint32(uint32_t* aData)
	{
		return readBytes(aData, sizeof(uint32_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::readInt32(int32_t* aData)
	{
		return readBytes(aData, sizeof(int32_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	bool File::writeBytes(const void* aData, size_t aSize)
	{
		if (!aData) return false;
		if (!isOpened()) return false;
		if (fwrite(aData, aSize, 1, mData->file) != 1) return false;
		else return true;
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::writeUint8(const uint8_t* aData)
	{
		return writeBytes(aData, sizeof(uint8_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::writeInt8(const int8_t* aData)
	{
		return writeBytes(aData, sizeof(int8_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::writeUint16(const uint16_t* aData)
	{
		return writeBytes(aData, sizeof(uint16_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::writeInt16(const int16_t* aData)
	{
		return writeBytes(aData, sizeof(int16_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::writeUint32(const uint32_t* aData)
	{
		return writeBytes(aData, sizeof(uint32_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	bool File::writeInt32(const int32_t* aData)
	{
		return writeBytes(aData, sizeof(int32_t));
	}
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////////////////////////
	File::~File()
	{
		close();
		delete mData;
	}

}





